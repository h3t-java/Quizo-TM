<databaseChangeLog
	xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                      http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.1.xsd">

	<property name="blob_type" value="bytea" dbms="postgresql"/>
	<property name="blob_type" value="LONGVARBINARY" dbms="h2"/>
	
	<changeSet author="Ivan Ivanov" id="createTable-spring_session">
	
		<createTable tableName="SPRING_SESSION">
			<column name="PRIMARY_ID" type="char(36)">
				<constraints nullable="false" primaryKey="true"
					primaryKeyName="SPRING_SESSION_PK" />
			</column>
			<column name="SESSION_ID" type="char(36)">
				<constraints nullable="false" />
			</column>
			<column name="CREATION_TIME" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="LAST_ACCESS_TIME" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="MAX_INACTIVE_INTERVAL" type="int">
				<constraints nullable="false" />
			</column>
			<column name="EXPIRY_TIME" type="bigint">
				<constraints nullable="false" />
			</column>
			<column name="PRINCIPAL_NAME" type="varchar(100)"/>
		</createTable>
		
		<createIndex 
			indexName="SPRING_SESSION_IX1"
            tableName="SPRING_SESSION"
            unique="true">
			<column name="SESSION_ID"/>
		</createIndex>
		<createIndex 
			indexName="SPRING_SESSION_IX2"
            tableName="SPRING_SESSION">
			<column name="EXPIRY_TIME"/>
		</createIndex>
		<createIndex 
			indexName="SPRING_SESSION_IX3"
            tableName="SPRING_SESSION">
			<column name="PRINCIPAL_NAME"/>
		</createIndex>
		
	</changeSet>
	
	<changeSet author="Ivan Ivanov" id="createTable-spring_session_attributes">
		
		<createTable tableName="SPRING_SESSION_ATTRIBUTES">
			<column name="SESSION_PRIMARY_ID" type="char(36)">
				<constraints nullable="false" />
			</column>
			<column name="ATTRIBUTE_NAME" type="varchar(200)">
				<constraints nullable="false" />
			</column>
			<column name="ATTRIBUTE_BYTES" type="${blob_type}">
				<constraints nullable="false" />
			</column>
		</createTable>
		
		<addPrimaryKey
			columnNames="SESSION_PRIMARY_ID, ATTRIBUTE_NAME"
            constraintName="SPRING_SESSION_ATTRIBUTES_PK"
            tableName="SPRING_SESSION_ATTRIBUTES"/>
			
		<addForeignKeyConstraint
			baseColumnNames="SESSION_PRIMARY_ID" 
			baseTableName="SPRING_SESSION_ATTRIBUTES"
			constraintName="SPRING_SESSION_ATTRIBUTES_FK" 
			onDelete="CASCADE"
			referencedColumnNames="PRIMARY_ID"
			referencedTableName="SPRING_SESSION" />
			
	</changeSet>

</databaseChangeLog>